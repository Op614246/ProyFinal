<ion-header>
  <ion-toolbar>
    <div class="flex justify-between items-center px-1 py-2">
      <div class="flex items-center gap-3">
        <ion-button fill="clear" size="small" (click)="goBack()">
          <ion-icon name="chevron-back-outline" class="text-xl"></ion-icon>
        </ion-button>
      </div>
      <span class="text-base font-medium">{{titulo}}</span>
      <ion-button color="white" class="m-0"></ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-gray-50">
  <div class="p-4 space-y-3">
    
    <!-- Nombre de la tarea -->
    <div class="space-y-1">
      <label class="block text-xs text-gray-600 font-normal">Nombre de la tarea</label>
      <ion-input
        [(ngModel)]="nombreTarea"
        placeholder="Ej. Revisar inventario"
        fill="outline"
        class="text-sm">
      </ion-input>
    </div>

    <!-- Descripción de la tarea -->
    <div class="space-y-1">
      <label class="block text-xs text-gray-600 font-normal">Descripción de la tarea</label>
      <ion-textarea
        [(ngModel)]="descripcionTarea"
        placeholder="Escribe aquí..."
        rows="4"
        fill="outline"
        class="w-full text-xs">
      </ion-textarea>
    </div>
    
    <!-- Toggle de asignación -->
    <div class="space-y-1 bg-white p-3 rounded-lg border border-gray-200">
      <div class="flex items-center justify-between">
        <div>
          <label class="block text-sm text-gray-800 font-medium">Asignar a un usuario</label>
          <span class="text-xs text-gray-500">Marcar si la tarea será asignada directamente</span>
        </div>
        <ion-toggle mode="ios"
          [(ngModel)]="asignarUsuario"
          (ionChange)="onAsignarUsuarioChange()"
          color="primary">
        </ion-toggle>
      </div>
    </div>
    
    <!-- Sección de asignación (solo si está activado) -->
    <div *ngIf="asignarUsuario" class="space-y-3 bg-blue-50 p-3 rounded-lg border border-blue-200">
      <div class="flex gap-4">
        <!-- Tipo de asignación -->
        <div class="space-y-1 w-full">
          <label class="block text-xs text-gray-600 font-normal">Tipo de asignación</label>
          <ion-select
            [(ngModel)]="tipoAsignacion"
            placeholder="Asignar por usuario"
            fill="outline"
            interface="popover"
            class="text-xs bg-white"
            (ionChange)="onTipoAsignacionChange()">
            <ion-select-option value="usuario">Asignar por usuario</ion-select-option>
            <ion-select-option value="cargo">Filtrar por cargo</ion-select-option>
          </ion-select>
        </div>

        <!-- Cargo (cuando tipo es cargo) -->
        <div class="space-y-1 w-full" *ngIf="tipoAsignacion === 'cargo'">
          <label class="block text-xs text-gray-600 font-normal">Cargo</label>
          <div class="relative">
            <div 
              (click)="abrirModalCargo()"
              class="flex items-center justify-between p-3 border border-gray-300 rounded-lg bg-white cursor-pointer min-h-[44px]">
              <span class="text-xs">{{cargoSeleccionado}}</span>
              <fa-icon [icon]="faCaretDown" class="text-sm"></fa-icon>
            </div>
          </div>
        </div>
      </div>

      <!-- Usuario -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Usuario</label>
        <div class="relative">
          <div 
            (click)="abrirModalUsuario()"
            class="flex items-center justify-between p-3 border border-gray-300 rounded-lg bg-white cursor-pointer min-h-[44px]">
            <span class="text-sm" [class.text-gray-400]="usuario === 'Seleccionar usuario'">{{usuario}}</span>
            <fa-icon [icon]="faCaretDown" class="text-sm"></fa-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Categoría -->
    <div class="space-y-1">
      <label class="block text-xs text-gray-600 font-normal">Categoría</label>
      <ion-select
        [(ngModel)]="categoriaSeleccionadaId"
        placeholder="Seleccionar categoría"
        fill="outline"
        interface="popover"
        class="text-xs"
        (ionChange)="onCategoriaChange($event)">
        <ion-select-option *ngFor="let cat of categorias" [value]="cat.id">
          {{cat.nombre}}
        </ion-select-option>
      </ion-select>
    </div>
    
    <!-- Sucursal -->
    <div class="space-y-1">
      <label class="block text-xs text-gray-600 font-normal">Sucursal</label>
      <ion-select
        [(ngModel)]="sucursalSeleccionadaId"
        placeholder="Seleccionar sucursal"
        fill="outline"
        interface="popover"
        class="text-xs"
        (ionChange)="onSucursalChange($event)">
        <ion-select-option *ngFor="let suc of sucursales" [value]="suc.id">
          {{suc.nombre}}
        </ion-select-option>
      </ion-select>
    </div>

    <!-- Fechas -->
    <div class="grid grid-cols-2 gap-4">
      <!-- Fecha de Asignación -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Fecha Asignación</label>
        <ion-input
          type="date"
          [(ngModel)]="fechaAsignacion"
          fill="outline"
          class="text-xs"
          [min]="minFechaAsignacion">
        </ion-input>
      </div>

      <!-- Fecha Límite -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Fecha Límite</label>
        <ion-input
          type="date"
          [(ngModel)]="fechaLimite"
          fill="outline"
          class="text-xs"
          [min]="fechaAsignacion">
        </ion-input>
      </div>
    </div>

    <!-- Horarios -->
    <div class="grid grid-cols-2 gap-4">
      <!-- Hora Inicio -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Hora Inicio</label>
        <ion-input
          type="time"
          [(ngModel)]="horaInicio"
          fill="outline"
          class="text-xs">
        </ion-input>
      </div>

      <!-- Hora Fin -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Hora Fin</label>
        <ion-input
          type="time"
          [(ngModel)]="horaFin"
          fill="outline"
          class="text-xs"
          [min]="horaInicio">
        </ion-input>
      </div>
    </div>

    <!-- Fila de Orden y Prioridad -->
    <div class="grid grid-cols-2 gap-4">
      <!-- Orden -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Orden</label>
        <div class="relative">
          <div 
            (click)="abrirModalOrden()"
            class="flex items-center justify-between p-3 border border-gray-300 rounded-lg bg-white cursor-pointer min-h-[44px]">
            <span class="text-xs text-gray-900">{{orden}}</span>
            <ion-icon name="chevron-down-outline" class="text-gray-400 text-sm"></ion-icon>
          </div>
        </div>
      </div>

      <!-- Prioridad -->
      <div class="space-y-1">
        <label class="block text-xs text-gray-600 font-normal">Prioridad</label>
        <ion-select
          [(ngModel)]="prioridad"
          placeholder="Alta"
          fill="outline"
          interface="popover"
          class="text-xs">
          <ion-select-option value="high">Alta</ion-select-option>
          <ion-select-option value="medium">Media</ion-select-option>
          <ion-select-option value="low">Baja</ion-select-option>
        </ion-select>
      </div>
    </div>

    <!-- Estado -->
    <div class="space-y-1">
      <label class="block text-xs text-gray-600 font-normal">Estado</label>
      <div class="flex items-center gap-3">
        <ion-toggle mode="ios"
          [(ngModel)]="estadoActivo"
          color="primary">
        </ion-toggle>
        <span class="text-sm text-gray-700">Activo</span>
      </div>
    </div>
  </div>
</ion-content>

<ion-footer class="w-full p-4 bg-white">
  <ion-button
    expand="block"
    color="primary"
    size="large"
    (click)="crearTarea()">
    {{modoEdicion ? 'Actualizar tarea' : 'Agregar tarea'}}
  </ion-button>
</ion-footer>