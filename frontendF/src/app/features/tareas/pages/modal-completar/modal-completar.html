<ion-header>
  <ion-toolbar>
    <ion-title class="text-base font-semibold">{{ subtarea ? 'Completar Subtarea' : 'Completar Tarea' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrarModal()">
        <fa-icon [icon]="faXmark" class="text-gray-500 text-xl"></fa-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="px-2">
  
  <!-- Información de la tarea (solo si no hay subtarea) -->
  <div class="mb-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400" *ngIf="tarea && !subtarea">
    <h3 class="font-medium text-blue-900 mb-1">{{ tarea.titulo }}</h3>
    <p class="text-sm text-blue-700">
      Estado actual: <span class="font-medium">{{ tarea.estado }}</span>
    </p>
    <p class="text-sm text-blue-700" *ngIf="tarea.Categoria">
      Categoría: <span class="font-medium">{{ tarea.Categoria }}</span>
    </p>
  </div>

  <!-- Info subtarea -->
  <div class="mb-4 p-3 bg-green-50 rounded-lg border-l-4 border-green-400" *ngIf="subtarea">
    <p class="text-xs text-green-600 mb-1" *ngIf="tarea">Tarea: {{ tarea.titulo }}</p>
    <h3 class="font-medium text-green-900 mb-1">{{ subtarea.titulo }}</h3>
    <p class="text-sm text-green-700" *ngIf="subtarea.descripcion">
      {{ subtarea.descripcion }}
    </p>
    <p class="text-sm text-green-700">
      Estado: <span class="font-medium">{{ subtarea.estado }}</span>
    </p>
  </div>

  <div class="flex flex-col gap-4">
    
    <!-- Observaciones -->
    <div>
      <span class="text-sm font-medium text-gray-700 mb-2 block">
        Observaciones <span class="text-red-500">*</span>
      </span>
      <ion-textarea
        fill="outline"
        placeholder="Describe cómo completaste la tarea, observaciones importantes..."
        [(ngModel)]="observaciones"
        [autoGrow]="true"
        rows="4"
        class="custom-textarea"
      ></ion-textarea>
    </div>

    <!-- Agregar imágenes -->
    <div>
      <span class="text-sm font-medium text-gray-700 mb-2 block">
        Evidencia fotográfica (opcional)
      </span>
      
      <!-- Advertencia de tamaño -->
      <div class="flex items-start gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg mb-3">
        <fa-icon [icon]="faExclamationTriangle" class="text-yellow-500 mt-0.5"></fa-icon>
        <div class="text-xs text-yellow-700">
          <p class="font-medium">Importante:</p>
          <ul class="mt-1 space-y-0.5">
            <li>• Tamaño máximo: <strong>1.5 MB</strong> por imagen</li>
            <li>• Formatos permitidos: JPEG, PNG, GIF, WebP</li>
          </ul>
        </div>
      </div>
      
      <!-- Grid de imágenes -->
      <div class="grid grid-cols-3 gap-2 mb-3" *ngIf="imagenes.length > 0">
        <div *ngFor="let imagen of imagenes; let i = index" class="relative aspect-square rounded-lg overflow-hidden">
          <img [src]="imagen" class="w-full h-full object-cover" alt="Evidencia">
          <button 
            class="absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"
            (click)="eliminarImagen(i)">
            <fa-icon [icon]="faTrash" class="text-xs"></fa-icon>
          </button>
        </div>
      </div>

      <!-- Botón agregar imagen -->
      <button 
        class="w-full p-4 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-primary hover:bg-blue-50 transition-all"
        (click)="agregarImagen()"
        [disabled]="cargandoImagen">
        <div *ngIf="!cargandoImagen" class="flex flex-col items-center gap-2">
          <fa-icon [icon]="faCamera" class="text-2xl text-gray-400"></fa-icon>
          <span class="text-sm text-gray-500">Agregar imagen</span>
        </div>
        <div *ngIf="cargandoImagen" class="flex items-center gap-2">
          <ion-spinner name="crescent" class="w-5 h-5"></ion-spinner>
          <span class="text-sm text-gray-500">Cargando...</span>
        </div>
      </button>
    </div>

  </div>
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar>
    <div class="footer-buttons p-4 flex gap-3">
      <ion-button 
        expand="block" 
        fill="outline" 
        class="flex-1"
        (click)="cerrarModal()">
        Cancelar
      </ion-button>
      <ion-button 
        expand="block" 
        class="flex-1"
        [disabled]="!puedeConfirmar"
        (click)="confirmarCompletar()">
        <fa-icon [icon]="faCheck" class="mr-2"></fa-icon>
        Completar
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>