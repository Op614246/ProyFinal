<ion-header>
  <ion-toolbar class="px-2">
    <ion-title class="text-lg font-bold">Reaperturar tarea</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onDismiss()">
        <fa-icon [icon]="faXmark" class="text-gray-500 text-xl"></fa-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="space-y-5 px-2">
    <!-- Motivo (reapertura) -->
    <div>
      <label class="block pt-4 text-sm font-medium text-gray-700 mb-2">
        Motivo de reapertura <span class="text-red-500">*</span>
      </label>
      <ion-select [(ngModel)]="motivoReapertura" placeholder="Seleccionar motivo" interface="action-sheet" mode="ios">
        <ion-select-option *ngFor="let m of motivosReapertura" [value]="m">{{ m }}</ion-select-option>
      </ion-select>
    </div>

    <!-- Observaciones -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Observaciones</label>
      <ion-textarea
        [(ngModel)]="observaciones"
        placeholder="Comentarios adicionales (opcional)"
        rows="3"
        fill="outline"
        mode="md">
      </ion-textarea>
    </div>

    <!-- Prioridad nueva -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Prioridad nueva</label>
      <ion-select [(ngModel)]="prioridadNueva" placeholder="Seleccionar prioridad" interface="action-sheet" mode="ios">
        <ion-select-option *ngFor="let p of prioridades" [value]="p.valor">{{ p.texto }}</ion-select-option>
      </ion-select>
    </div>

    <!-- Fecha vencimiento nueva (min = hoy) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de vencimiento nueva</label>
      <ion-datetime display-format="DD/MM/YYYY" picker-format="DD/MM/YYYY" [(ngModel)]="fechaVencimientoNueva" [min]="minFechaVencimiento"></ion-datetime>
    </div>

    <!-- Toggle reasignar -->
    <div class="flex items-center justify-between py-2">
      <label class="text-sm font-medium text-gray-700">¿Reasignar tarea?</label>
      <ion-toggle [(ngModel)]="reasignarTarea" (ionChange)="onToggleChange()" mode="ios"></ion-toggle>
    </div>

    <!-- Campos de reasignación -->
    <div *ngIf="reasignarTarea" class="space-y-4 pl-4 border-l-2 border-blue-400">
      <!-- Selección de cargo -->
      <div>
        <label class="block text-xs text-gray-500 mb-1">Cargo</label>
          <ion-select 
            [(ngModel)]="cargoSeleccionado" 
            placeholder="Seleccionar cargo"
            interface="action-sheet"
            mode="ios"
            class="w-full border border-gray-300 rounded-lg"
            (ionChange)="onCargoChange($event)">
            <ion-select-option *ngFor="let c of cargos" [value]="c">{{ c }}</ion-select-option>
          </ion-select>
      </div>

      <!-- Selección de usuario -->
      <div>
        <label class="block text-xs text-gray-500 mb-1">Usuario</label>
        <ion-select 
          [(ngModel)]="usuarioSeleccionado" 
          placeholder="Seleccionar usuario"
          interface="action-sheet"
          mode="ios"
          class="w-full border border-gray-300 rounded-lg">
          <ion-select-option *ngFor="let u of usuariosFiltrados" [value]="u.id">{{ u.nombre_completo || u.username }}</ion-select-option>
        </ion-select>
      </div>
    </div>
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar>
    <div class="p-4 flex gap-3">
      <ion-button fill="outline" color="medium" expand="block" class="flex-1" (click)="cancelar()">
        Cancelar
      </ion-button>
      <ion-button fill="solid" color="primary" expand="block" class="flex-1" 
                  [disabled]="!puedeConfirmar" (click)="confirmar()">
        <fa-icon [icon]="faCheck" class="mr-2"></fa-icon>
        Confirmar
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
