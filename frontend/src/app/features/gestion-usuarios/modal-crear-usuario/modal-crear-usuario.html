<p-dialog header="Crear Nuevo Usuario" 
          [(visible)]="visible" 
          [modal]="true" 
          [closable]="true"
          [dismissableMask]="true"
          [style]="{width: '450px'}"
          styleClass="user-modal">
  
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <!-- Username -->
    <div class="mb-4">
      <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
        <fa-icon [icon]="['far', 'user']" class="mr-1"></fa-icon>
        Nombre de usuario
      </label>
      <div class="relative input-with-icon">
        <span class="absolute left-3 text-gray-400 icon-left">
          <fa-icon [icon]="['far', 'user']" class="text-lg"></fa-icon>
        </span>
        <input type="text" 
               pInputText 
               id="username" 
               formControlName="username"
               placeholder="Ingresa el nombre de usuario"
               class="w-full pl-12"
               [ngClass]="{'ng-invalid ng-dirty': f['username'].touched && f['username'].invalid}">
      </div>
      @if (f['username'].touched && f['username'].errors) {
        @if (f['username'].errors['required']) {
          <small class="text-red-500">El nombre de usuario es requerido</small>
        }
        @if (f['username'].errors['minlength']) {
          <small class="text-red-500">Mínimo 3 caracteres</small>
        }
        @if (f['username'].errors['maxlength']) {
          <small class="text-red-500">Máximo 50 caracteres</small>
        }
      }
    </div>

    <!-- Password -->
    <div class="mb-4">
      <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
        <fa-icon [icon]="['far', 'lock']" class="mr-1"></fa-icon>
        Contraseña
      </label>
      <div class="relative input-with-icon">
        <span class="absolute left-3 text-gray-400 icon-left">
          <fa-icon [icon]="['far', 'lock']" class="text-lg"></fa-icon>
        </span>
        <p-password id="password"
                    formControlName="password"
                    [toggleMask]="true"
                    [feedback]="true"
                    placeholder="Ingresa la contraseña"
                    styleClass="w-full"
                    inputStyleClass="w-full pl-12 pr-10"
                    [ngClass]="{'ng-invalid ng-dirty': f['password'].touched && f['password'].invalid}">
        </p-password>
      </div>
      @if (f['password'].touched && f['password'].errors) {
        @if (f['password'].errors['required']) {
          <small class="text-red-500">La contraseña es requerida</small>
        }
        @if (f['password'].errors['minlength']) {
          <small class="text-red-500">Mínimo 6 caracteres</small>
        }
      }
    </div>

    <!-- Confirm Password -->
    <div class="mb-4">
      <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
        <fa-icon [icon]="['far', 'lock']" class="mr-1"></fa-icon>
        Confirmar Contraseña
      </label>
      <div class="relative input-with-icon">
        <span class="absolute left-3 text-gray-400 icon-left">
          <fa-icon [icon]="['far', 'lock']" class="text-lg"></fa-icon>
        </span>
        <p-password id="confirmPassword"
                    formControlName="confirmPassword"
                    [toggleMask]="true"
                    [feedback]="false"
                    placeholder="Confirma la contraseña"
                    styleClass="w-full"
                    inputStyleClass="w-full pl-12 pr-10"
                    [ngClass]="{'ng-invalid ng-dirty': f['confirmPassword'].touched && f['confirmPassword'].invalid}">
        </p-password>
      </div>
      @if (f['confirmPassword'].touched && f['confirmPassword'].errors) {
        @if (f['confirmPassword'].errors['required']) {
          <small class="text-red-500">Confirma la contraseña</small>
        }
        @if (f['confirmPassword'].errors['passwordMismatch']) {
          <small class="text-red-500">Las contraseñas no coinciden</small>
        }
      }
    </div>

    <!-- Role -->
    <div class="mb-6">
      <label for="role" class="block text-sm font-medium text-gray-700 mb-2">
        <fa-icon [icon]="['far', 'user-gear']" class="mr-1"></fa-icon>
        Rol
      </label>
      <p-select id="role"
                formControlName="role"
                [options]="roles"
                placeholder="Selecciona un rol"
                styleClass="w-full"
                [ngClass]="{'ng-invalid ng-dirty': f['role'].touched && f['role'].invalid}">
      </p-select>
      @if (f['role'].touched && f['role'].errors?.['required']) {
        <small class="text-red-500">El rol es requerido</small>
      }
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <button pButton 
              type="button" 
              label="Cancelar" 
              class="p-button-text"
              (click)="cerrar()"
              [disabled]="loading">
      </button>
      <button pButton 
              type="button" 
              label="Crear Usuario" 
              class="p-button-primary"
              (click)="onSubmit()"
              [loading]="loading"
              [disabled]="userForm.invalid">
        <fa-icon [icon]="['far', 'user-plus']" class="mr-2" *ngIf="!loading"></fa-icon>
      </button>
    </div>
  </ng-template>
</p-dialog>

<!-- Toast para errores del modal -->
<p-toast></p-toast>
